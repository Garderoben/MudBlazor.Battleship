@using MudBlazor.Battleship.Models;

@if(!isSignedIn)
{
    <MudGrid>
        <MudItem xs="12" sm="12" md="3" lg="2" Class="d-flex">
            <MudPaper Elevation="0" Height="300px" Width="100%" Class="mud-transparent mt-0 mt-md-16 pt-md-16">
                <MudText Typo="Typo.h5">Sign In</MudText>
                <EditForm Model="@user" OnValidSubmit="SignIn">
                    <DataAnnotationsValidator />
                    <div class="d-flex align-center" style="height:100px">
                            <MudTextField @bind-Value="@user.Username" For="@(() => user.Username)" Label="Username" Variant="Variant.Text" />
                    </div>
                    <MudButton ButtonType="ButtonType.Submit" Color="Color.Primary" Variant="Variant.Filled" DisableElevation="true" FullWidth="true" Class="mt-6">Sign In</MudButton>
                </EditForm>
            </MudPaper>
        </MudItem>
    </MudGrid>
}
else if(isSignedIn)
{
    <MudGrid>
        <MudItem xs="12" Class="py-0">
            <MudToolBar DisableGutters="true" Dense="true">
                <MudButton OnClick="NewLobby" Color="Color.Primary">Create Lobby</MudButton>
            </MudToolBar>
        </MudItem>
        <MudItem xs="12" sm="12" md="3">
            <MudPaper MinHeight="50vh" Height="100%" Elevation="0" Class="pb-4">
                <div class="px-5 py-3 mb-2 battleship-lobby-card-header">
                    <MudText Typo="Typo.h5">@user.Username</MudText>
                </div>
                <MudGrid Spacing="0">
                    <UserStatsCard UserStats="@(new UserStats("Rank", 20, "Top 31%"))" />
                    <UserStatsCard UserStats="@(new UserStats("Games", 440, "Top 18%"))" />
                    <UserStatsCard UserStats="@(new UserStats("Wins", 121, "Top 33%"))" />
                    <UserStatsCard UserStats="@(new UserStats("Win %", 60, "Top 18%"))" />
                </MudGrid>
                @*@foreach(var users in GameMode.GetUsers())
                {
                    <MudText>@users.Name;</MudText>
                    <MudText>@users.ConnectionId;</MudText>
                }*@
            </MudPaper>
        </MudItem>
        <MudItem xs="12" sm="12" md="6">
            <MudTable Height="100%" Elevation="0" Items="@_lobbys" Hover="true">
                <HeaderContent>
                    <MudTh>#</MudTh>
                    <MudTh>Lobby Name</MudTh>
                    <MudTh>Players</MudTh>
                    <MudTh>Status</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd>
                        @if(!string.IsNullOrEmpty(context.Password))
                        {
                            <MudIcon Icon="@Icons.Material.Filled.Shield" />
                        }
                    </MudTd>
                    <MudTd>@context.Name</MudTd>
                    <MudTd>@context.Players</MudTd>
                    <MudTd>Ongoing</MudTd>
                </RowTemplate>
                <NoRecordsContent>
                    <MudPaper MinHeight="50vh" Height="100%" Elevation="0" Class="pa-4 d-flex align-center justify-center">
                        <MudText Typo="Typo.h5">No Hosted Lobbys</MudText>
                    </MudPaper>
                </NoRecordsContent>
            </MudTable>
        </MudItem>
        <MudItem xs="12" sm="12" md="3">
            <MudPaper MinHeight="50vh" Height="100%" Elevation="0" Class="pb-4 d-flex flex-column">
                 <div class="px-5 py-3 mb-2  battleship-lobby-card-header">
                    <MudText Typo="Typo.h5">Chat</MudText>
                </div>
                <div class="flex-grow-1">
                    @foreach(var chat in _messages)
                    {
                        <UserChatMessage Data="chat" Color="@(user.Username == chat.Username? Color.Primary : Color.Default)" />
                    } 
                </div>
                <div class="battleship-lobby-chat-input-field mx-4 px-2">
                    <MudTextField @ref="ChatTextField" @bind-Value="NewMessage" OnKeyUp="@OnKeyUp" Variant="Variant.Outlined" Placeholder="Message" Margin="Margin.Dense" Class="my-0" />
                </div>
            </MudPaper>
        </MudItem>
    </MudGrid>    
}